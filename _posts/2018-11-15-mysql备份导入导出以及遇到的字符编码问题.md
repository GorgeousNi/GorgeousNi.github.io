--- 
layout: post
title: 'Mysql Centos å¤‡ä»½å¯¼å…¥å¯¼å‡º'
date: 2018-11-15
author: GorgeousNi
color: RGB(37,137,185)
cover: '/assets/doc_img/mysql-20181111.png'
tags: Mysql
---


# MySQL å¤‡ä»½å®è·µ

> åŸæ•°æ®åº“æˆªå›¾   

![](/assets/doc_img/20181115/1.png)

---
> ## 1ã€å¤‡ä»½å¯¼å‡º   
**mysqldump -uç”¨æˆ· -på¯†ç  æ•°æ®åº“å > ï¼ˆç›®å½•ï¼‰å¯¼å‡ºæ–‡ä»¶å**  
ä¸è¿‡ä¸å»ºè®®å¯†ç è¾“å…¥åœ¨å‘½ä»¤è¡Œï¼Œå¹¶ä¸”centosä¹Ÿä¼šç»™å‡ºè­¦å‘Š

![](/assets/doc_img/20181115/3.png)

```
mysqldump -uroot -p vip-manager >  vip-manager-bak.sql
```

---
> ## 2ã€å¤‡ä»½å¯¼å…¥åº“

``` 
mysql -u root -p
``` 
``` 
mysql> create database jiaxintestbak01;
``` 
``` 
mysql> use jiaxintestbak01;
``` 
``` 
mysql> source /mnt/data/mysql_data/jiaxintest.sql;
``` 

![](/assets/doc_img/20181115/4.png)

* è¡¨æƒ…emojiæ­£å¸¸å±•ç¤º

![](/assets/doc_img/20181115/5.png)



---

> ## 3ã€å¸¸è§é—®é¢˜ä¹‹è¡¨æƒ…åŒ…ä¿å­˜

> Exception: MySQL Error: Incorrect string value: '\xF0\x9F\x90\xB1' for column ......

> Emojiè¡¨æƒ…ç¬¦å·ä¸º4ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼Œè€Œ utf8 å­—ç¬¦é›†åªæ”¯æŒ1-3ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼Œæ‰€ä»¥æ— æ³•å†™å…¥æ•°æ®åº“ã€‚ï¼ˆmysqlç‰ˆæœ¬éœ€è¦é«˜äº5.5.3ï¼‰
* è§£å†³æ–¹å¼ï¼šæ›´æ¢å­—ç¬¦é›†utf8-->utf8mb4 ;

> mb4çš„æ„æ€æ˜¯most bytes 4ï¼Œä¸“é—¨ä¸ºå…¼å®¹å››ä¸ªå­—èŠ‚çš„ã€‚utf8mb4æ˜¯å‘ä¸‹å…¼å®¹utf8çš„ï¼Œæ‰€ä»¥å³ä¾¿ä¿®æ”¹äº†å­—æ®µçš„å­—ç¬¦é›†ä¹Ÿä¸ä¼šå½±å“çº¿ä¸Šæ•°æ®ã€‚
* ä¿®æ”¹å¯ä»¥åˆ†ä¸ºå…¨å±€ä¿®æ”¹å’Œå½“å‰é“¾æ¥ä¿®æ”¹ã€‚
   * å…¨å±€ä¿®æ”¹éœ€è¦ä¿®æ”¹æœåŠ¡å™¨ç«¯çš„é…ç½®
   * ä¼šè¯ä¿®æ”¹åªéœ€è¦åœ¨é“¾æ¥æ—¶è¿›è¡Œä¿®æ”¹

> ###  å­—ç¬¦é›†ä»‹ç»
> character_set_clientï¼šå®¢æˆ·ç«¯æ¥æºæ•°æ®ä½¿ç”¨çš„å­—ç¬¦é›†  
 character_set_connectionï¼šè¿æ¥å±‚å­—ç¬¦é›†  
 character_set_databaseï¼šå½“å‰é€‰ä¸­æ•°æ®åº“çš„é»˜è®¤å­—ç¬¦é›†  
 character_set_serverï¼šé»˜è®¤çš„å†…éƒ¨æ“ä½œå­—ç¬¦é›†  
 character_set_resultsï¼šæŸ¥è¯¢ç»“æœå­—ç¬¦é›†  
 character_set_systemï¼šç³»ç»Ÿå…ƒæ•°æ®(å­—æ®µåç­‰)å­—ç¬¦é›†  


> ### æœåŠ¡å™¨ç«¯é…ç½®ï¼šä¿®æ”¹my.iniæ•°æ®åº“é…ç½®
> vim /etc/my.cnf æ·»åŠ å¦‚ä¸‹é…ç½®

```
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
```

---   
> æœ‰çš„äººé‡åˆ°äº†å¤‡ä»½åè¡¨æƒ…åŒ…æ— æ³•æ­£å¸¸å±•ç¤ºï¼ˆps æˆ‘æ²¡æœ‰é‡åˆ°ã€‚ã€‚ã€‚ï¼‰   
æ‰€ä»¥å»ºè®®æ’æŸ¥  
1ã€è®¾ç½®åº“ç¼–ç 
```  mysql> show variables like "%char%";```  
2ã€é‡æ–°å¯¼å…¥

> ä¸ºæ­¤ æˆ‘ç‰¹åœ°å»é‡ç°äº†ä¸€é

> **æ€»ç»“ä»¥ä¸‹å››ç§æƒ…å†µ**


> æœ¬åœ°é‡ç°

#### æ“ä½œä¸€
```
mysql> set character_set_server='utf8mb4';  
Query OK, 0 rows affected (0.00 sec)
mysql> show variables like "%char%";
```
![](/assets/doc_img/20181115/9.png)
* å¯¼å‡º   
![](/assets/doc_img/20181115/10.png)
* å¯¼å…¥  
![](/assets/doc_img/20181115/11.png)
* å‡ºç°ä¹±ç   
![](/assets/doc_img/20181115/12.png)
* æŸ¥è¯¢å­—ç¬¦ä¸²  
![](/assets/doc_img/20181115/13.png)
* é‡æ–°è®¾ç½®å­—ç¬¦ä¹Ÿä¸è¡Œ  
![](/assets/doc_img/20181115/14.png)


#### æ“ä½œäºŒ

* å…ˆè®¾ç½®å­—ç¬¦é›†  
![](/assets/doc_img/20181115/15.png)
* åœ¨å¯¼å…¥  
![](/assets/doc_img/20181115/16.png)
* ä¾æ—§ä¹±ç   
![](/assets/doc_img/20181115/17.png)
* é‡å¯mysqlæœåŠ¡å™¨ ç¼–ç è¿˜åŸ   
![](/assets/doc_img/20181115/19.png)


#### æ“ä½œä¸‰

> Macé»˜è®¤æ— my.cnf é…ç½®æ–‡ä»¶
é’ˆå¯¹macç«¯ï¼Œå¹¶ä¸”æ²¡æœ‰my-default.cnfçš„ç”¨æˆ·
* æˆ‘ä»¬è¦åœ¨/etcä¸‹æ–°å»ºmy.cnf  
$ cd /etc   
$ sudo vim my.cnf  ï¼ˆé™„ä¸Šæˆ‘çš„é…ç½®æ–‡ä»¶,è§æ–‡ç« æœ€ä¸‹é¢ï¼‰
* é‡æ–°ä¿®æ”¹å­—ç¬¦ç¼–ç ï¼Œå¢åŠ ä»¥ä¸‹é…ç½®åï¼Œé‡å¯mysql
```
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
```
* é‡æ–°å¯¼å…¥æ–‡ä»¶
![](/assets/doc_img/20181115/22.png)

* ä¾æ—§ä¹±ç 
![](/assets/doc_img/20181115/23.png)


#### æ“ä½œå››
* äºæ˜¯å†³å®šé‡æ–°å¯¼å‡ºï¼Œåœ¨å¯¼å…¥
![](/assets/doc_img/20181115/24.png)  

![](/assets/doc_img/20181115/25.png)  

![](/assets/doc_img/20181115/26.png)  

* å®Œç¾è§£å†³

<a href="/assets/doc_xml/my.cnf" title="**my.cnf é™„ä»¶ğŸ“**">
---
